<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <title>Login</title>
</head>
<body>
    <h1>Login</h1>
    <div class="container">
        <form>
            <table>
                <tr>
                    <td><div id="msg"></div></td>
                </tr>
                <tr>
                    <td><input type="email" name="email" id="email" placeholder="Email" required></td>
                </tr>
                <tr>
                    <td><input type="password" anem="password" id="password" placeholder="password" required></td>
                </tr>
                <tr>
                    <td><button type="submit" id="login">Login</button> <br></td>
                </tr>
                <tr>
                    <td>OR</td>
                </tr>
                <tr>
                    <td><button onclick="location.href = 'Registration.html';">Register</button></td>
                </tr>
            </table>    
        </form>
    </div>

    <script>

        // get data from localstorage and check login credentials
        document.getElementById("login").addEventListener("click", function() {
            var email = document.getElementById("email").value;
            var pass = document.getElementById("password").value;

            // for admin
            var data = localStorage.getItem("AdminList");
            var d = JSON.parse(data);
            document.forms[0].reset();
            if(email === d[1] && pass === d[2]) {
                document.getElementById("msg").innerHTML="logged in successfully";
                console.log("logged in");
                location.href = 'dashboard.html';
                sessionStorage.setItem("adminName" , d[0]);
            }
            else {
                document.getElementById("msg").innerHTML="Please enter correct Details";
            }


            // for user
            users2 = JSON.parse(localStorage.getItem("userList") || "[]");
            users2.forEach(function (u) {
            if(email == u.email && pass == u.password) {
                document.getElementById("msg").innerHTML="logged in successfully";
                console.log("logged in");
                location.href = 'subuser.html';
                sessionStorage.setItem("clientName",u.name);
                sessionStorage.setItem("dob",u.dob);

                // store date and username into localStorage
                let userSessions = [];
                var date = new Date();
                let session = {
                    name : document.getElementById("uname").value,
                    login : date,
                }
                session2 = JSON.parse(localStorage.getItem("userSessions") || "[]");
                session2.forEach(function (u) {
                    userSessions.push(u);
                });
                userSessions.push(session);

                localStorage.setItem('userSessions', JSON.stringify(userSessions));
            }})
        });
    </script>
</body>
</html>